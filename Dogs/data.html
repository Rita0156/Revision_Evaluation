<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Page</title>
    <link rel="stylesheet" href="./styleCompo/data.css">
</head>
<body>
    <div id="nav">
        <a href="./index.html">Home</a>
        <a href="./data.html">Data</a>
        <a href="./report.html">Report</a>
    </div>
    <div id="sel">
        <select name="age" id="agesel">
            <option value="">Sort by age</option>
            <option value="low">Low to High</option>
            <option value="high">Hihg to low</option>
        </select>
        <select name="pet" id="gendersel">
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select>
    </div>
    <div id="container">

    </div>
    <div id="btns">
        <!-- <div id="button-wrapper"></div> -->
        <button id="next">Next</button>
          <h2 id="pageNo"></h2>
        <button id="prev">Previous</button>

    </div>
</body>
</html>
<script>
    let container=document.getElementById("container")
    //let dogData=JSON.parse(localStorage.getItem("dogs"))||[]
    //let buttonWrapper=document.getElementById("button-wrapper")
    let pageNo=document.getElementById("pageNo")
    let next=document.getElementById("next")
    let prev=document.getElementById("prev")
    let filData=[]
    let page=1
    let limit=4
    
   // function pagination(data,pageNo,limit){
   //        return data.slice((pageNo-1)*limit,(pageNo*limit-1)+1)
   // }

    const fetchData=(page,limit)=>{
      fetch(`http://localhost:3030/dogs?_page=${page}&_limit=${limit}`)
      .then((req)=>{
         return req.json()
      })
      .then((res)=>{
        // let lengthGet=res.headers.get('X-Total-Count');
         console.log(res,res.length);
         console.log(res.header);
         
         
         //let limit=4;
         let total=Math.ceil((res.length)/limit)
         //buttonWrapper.innerHTML=null
         let allPages=[]
         for(let i=0; i<=total; i++){
           allPages.push(i)
         }
         

         let lastPage=limit*page
         let firstPage=lastPage-limit

         // let currentPage=res.slice(firstPage,lastPage)
         // filData=[...currentPage]
         
         
         //let resArray=pagination(res,1,limit)
         Display(res)
      })
    }
    fetchData(page,limit)
    //console.log(filData,"fildata")
    //Display(dogData)
    //console.log(dogData)
   //  function createButton(i){
   //    let btn=document.createElement("button")
   //    //btn.innerText=i
   //    let activeClass = '';
   //     if(i==1){
   //      activeClass = 'active';
   //     }
   //    btn.className = `.pagination-button ${activeClass}`;
   //    btn.innerText = i;
   //    btn.addEventListener("click",()=>{
   //       page=i
   //       fetchData(page,limit)
   //    })

      
   
   //    return btn
   //  }

   //  setTimeout(async()=>{
   //    let butns=document.querySelectorAll("#button-wrapper>button")
   //    let req=await fetch('http://localhost:3030/dogs')
   //    let data=await req.json()
   //    let limit=4
   //    butns.forEach((btn)=>{
   //        btn.addEventListener("click",()=>{
            
   //             btn.forEach(btnb=> btnb.classList.remove('active'));
   //             btn.classList.add("active")
   //             let i = btn.innerText;
               
   //             let resArr = pagination(data, i, limit);
   //             Display(resArr);
   //        })
   //    })
   //  },300)
     let age=document.getElementById("agesel")
     let gender=document.getElementById("gendersel")



     age.addEventListener("change",()=>{
        let data=filData.filter((ele)=>{
           if(age.value==""){
            return  Display(filData)
           }else{
             if(age.value=="low"){
                filData.sort(function(a,b){return Number(a.age)-Number(b.age)})
                //Display(dogData)
                return  Display(filData)
             }else if(age.value=="high"){
                filData.sort(function(a,b){return Number(b.age)-Number(a.age)})
                return  Display(filData)
             }
             
           }
        })
       
     })

     gender.addEventListener("change",()=>{
        let fdata=filData.filter((ele)=>{
           if(gender.value==""){
            return  true
           }else{
             if(gender.value===ele.gender){
                return true
             }else{
                return false
             }
             
           }
        })
        Display(fdata)
       
     })

     next.addEventListener("click",()=>{
         page=page+1
         pageNo.innerText=page
         prev.style.color="black"
         fetchData(page,limit)
     })
     if(page==1){
         prev.style.color="grey"
       }
      
     prev.addEventListener("click",()=>{
       if(page==1){
         prev.disabled=true
         prev.style.color="grey"
       }else if(page>1){
         prev.style.color="black"
         page=page-1
         pageNo.innerText=page
         fetchData(page,limit)
       }
     })
 pageNo.innerText=page

    function Display(data){
        container.innerHTML=null
         data.forEach(element => {
            let div=document.createElement("div")
            let h2=document.createElement("h2")
            h2.innerText=element.name
            let city=document.createElement("h2")
            city.innerText=element.place
            let gender=document.createElement("h2")
            gender.innerText=element.gender
            let img=document.createElement("img")
            img.src="https://static.vecteezy.com/system/resources/thumbnails/026/910/473/small/cute-cartoon-fox-isolated-on-ground-ai-generated-png.png"
            let det=document.createElement("button")
            let age=document.createElement("h2")
            age.innerText=element.age
            det.innerText="Remove"
             det.addEventListener("click",()=>{
               let id=element.id
               console.log(id)
                const deleteData=(id)=>{
                  fetch(`http://localhost:3030/dogs/${id}`,{
                  method:"DELETE",
                  headers:{
                  "Content-Type": "application/json",
                  }
            

             })
            .then((req)=>{
            return req.json()
            })
           .then((res)=>{
            console.log(res);
            alert("Deleted Successfull")
            //window.location.href="./data.html"

            })
            .catch((err)=>{
                console.error(err);
                alert("Something went wrong")
              })
            }
                //Display(lsData)
                deleteData(id)
                fetchData()
             })
            div.append(h2,img,age,gender,city,det)
            container.append(div)

         });

    }
    

</script>